<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BGMI Tournament Points Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#f6f7fb; --card:#ffffff; --ink:#222; --muted:#666;
      --brand:#2563eb; --brand-ink:#fff; --ok:#10b981; --warn:#ef4444;
      --row:#f3f4f6; --row2:#eef2ff;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:var(--ink); background:var(--bg);}
    header{padding:22px 16px; text-align:center;}
    header h1{margin:0 0 6px; font-size:24px;}
    header .sub{color:var(--muted); font-size:14px;}
    .wrap{max-width:1100px; margin:0 auto; padding:0 16px 40px;}
    .card{background:var(--card); border-radius:14px; box-shadow:0 6px 20px rgba(0,0,0,.06); padding:16px;}
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}
    .options{margin:14px 0 18px;}
    .teams-grid{display:grid; grid-template-columns:repeat(2,minmax(280px,1fr)); gap:12px;}
    @media (max-width: 820px){ .teams-grid{grid-template-columns:1fr;} }
    .team{background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:10px;}
    .team h3{margin:0 0 6px; font-size:14px; color:var(--muted);}
    .inputs{display:grid; grid-template-columns:1.2fr .8fr .8fr .9fr .7fr; gap:8px; align-items:center}
    .inputs input[type="text"], .inputs input[type="number"]{
      width:100%; padding:8px 10px; border:1px solid #e5e7eb; border-radius:8px; font-size:14px;
    }
    .bar{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px}
    .btn{border:0; border-radius:10px; padding:10px 14px; font-weight:600; cursor:pointer}
    .btn.primary{background:var(--brand); color:var(--brand-ink)}
    .btn.ghost{background:#e5e7eb}
    .btn.ok{background:var(--ok); color:#fff}
    .btn.warn{background:var(--warn); color:#fff}
    .error{color:var(--warn); font-size:13px; margin:6px 0 0 2px}
    .muted{color:var(--muted)}
    table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:12px; background:#fff; margin-top:14px}
    thead th{background:#111827; color:#fff; font-weight:600; font-size:14px; padding:10px}
    tbody td{padding:10px; text-align:center; border-bottom:1px solid #f0f2f5; font-size:14px}
    tbody tr:nth-child(odd){background:var(--row)}
    tbody tr:nth-child(even){background:var(--row2)}
    tbody tr:first-child td{font-weight:700}
    .rank-badge{display:inline-block; min-width:30px; padding:2px 8px; border-radius:999px; background:#111827; color:#fff}
    .top1{background:#f59e0b}
    .top2{background:#9ca3af}
    .top3{background:#b45309}
    .panel{display:flex; gap:10px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-top:16px}
    .right{display:flex; gap:10px; align-items:center}
    .select{padding:8px 10px; border:1px solid #e5e7eb; border-radius:8px; background:#fff}
  </style>
</head>
<body>
<header>
  <h1>BGMI Tournament Points Calculator</h1>
  <div class="sub">Placement + Finishes (Impact optional √ó2) + Bounty (+10). Tracks matches played.</div>
</header>
<div class="wrap">
  <div class="card">
    <div class="panel">
      <div class="row">
        <label><input type="checkbox" id="enableImpact" /> Enable Impact Player (√ó2 per impact finish)</label>
        <label><input type="checkbox" id="enableBounty" /> Enable Bounty Points (+10 per bounty kill)</label>
      </div>
      <div class="right">
        <label class="row muted">Teams:
          <select id="teamCount" class="select">
            <option value="24" selected>24</option>
            <option value="16">16</option>
          </select>
        </label>
        <button class="btn ghost" id="exportPng">Export Leaderboard PNG</button>
      </div>
    </div>
    <div id="error" class="error"></div>
    <div id="teams" class="teams-grid"></div>
    <div class="bar">
      <button class="btn primary" id="addMatchBtn">‚ûï Add Match</button>
      <button class="btn ok" id="generateTableBtn">üìä Generate Points Table</button>
      <button class="btn warn" id="resetBtn">‚ôª Reset Tournament</button>
      <span class="muted">Tip: Enter moves to next field. Use Add Match button to save.</span>
    </div>
  </div>
  <div class="card" id="leaderboardCard">
    <h2 style="margin:0 0 10px">üèÜ Leaderboard <span id="matchCount"></span></h2>
    <table>
      <thead>
        <tr><th>Rank</th><th>Team</th><th>Total Points</th></tr>
      </thead>
      <tbody id="leaderboardBody"></tbody>
    </table>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js" defer></script>
<script>
(() => {
  const DEFAULT_TEAMS=24;
  const IMPACT_MULTIPLIER=2; // fixed to 2x
  function placementPoints(p){return [10,6,5,4,3,2,1][p-1]||0;}
  let standings=JSON.parse(localStorage.getItem("standings")||"{}");
  let canonicalNames=JSON.parse(localStorage.getItem("canonicalNames")||"{}");
  let teamCount=parseInt(localStorage.getItem("teamCount")||DEFAULT_TEAMS,10);
  let matchesPlayed=parseInt(localStorage.getItem("matchesPlayed")||"0",10);
  const els={
    enableImpact:document.getElementById("enableImpact"),
    enableBounty:document.getElementById("enableBounty"),
    teamCount:document.getElementById("teamCount"),
    teamsWrap:document.getElementById("teams"),
    error:document.getElementById("error"),
    addMatchBtn:document.getElementById("addMatchBtn"),
    generateTableBtn:document.getElementById("generateTableBtn"),
    resetBtn:document.getElementById("resetBtn"),
    exportPng:document.getElementById("exportPng"),
    leaderboardBody:document.getElementById("leaderboardBody"),
    matchCount:document.getElementById("matchCount")
  };
  function buildInputs(){
    els.teamsWrap.innerHTML="";
    for(let i=1;i<=teamCount;i++){
      const t=document.createElement("div");t.className="team";
      t.innerHTML=`<h3>Team ${i}</h3>
      <div class="inputs">
        <input type="text" id="name${i}" placeholder="Team name" value="${canonicalNames[i]||""}" />
        <input type="number" id="placement${i}" placeholder="Place" min="1" max="${teamCount}" />
        <input type="number" id="finishes${i}" placeholder="Finishes" min="0" />
        <input type="number" id="impact${i}" placeholder="Impact" min="0" value="0" />
        <label><input type="checkbox" id="bounty${i}" /> Bounty</label>
      </div>`;
      els.teamsWrap.appendChild(t);
    }
    wireEnterAdvance();
  }
  function wireEnterAdvance(){
    const inputs=els.teamsWrap.querySelectorAll('input');
    inputs.forEach((el,idx)=>{
      el.addEventListener('keydown',e=>{
        if(e.key==="Enter"){e.preventDefault(); if(inputs[idx+1])inputs[idx+1].focus();}
      });
    });
  }
  function uniqueName(base,taken){if(!taken.includes(base))return base;let k=2;while(taken.includes(`${base} (${k})`))k++;return`${base} (${k})`;}
  function addMatch(){
    els.error.textContent="";
    const enableImpact=els.enableImpact.checked, enableBounty=els.enableBounty.checked;
    const taken=Object.keys(standings);
    let added=false;
    for(let i=1;i<=teamCount;i++){
      let name=(document.getElementById(`name${i}`).value||`Team ${i}`).trim();
      let p=parseInt(document.getElementById(`placement${i}`).value||"0");
      let f=parseInt(document.getElementById(`finishes${i}`).value||"0");
      let imp=parseInt(document.getElementById(`impact${i}`).value||"0");
      let bounty=document.getElementById(`bounty${i}`).checked;
      if(p<0||f<0||imp<0){els.error.textContent="Values cannot be negative.";return;}
      if(p>teamCount){els.error.textContent=`Placement > ${teamCount}`;return;}
      if(imp>f)imp=f;
      if(!canonicalNames[i]){canonicalNames[i]=uniqueName(name,taken);taken.push(canonicalNames[i]);}
      const team=canonicalNames[i];
      if(p||f||imp||bounty){ // count only filled rows
        const total=placementPoints(p)+(f-(enableImpact?imp:0))*1+(enableImpact?imp*IMPACT_MULTIPLIER:0)+(enableBounty&&bounty?10:0);
        standings[team]=(standings[team]||0)+total; added=true;
      }
    }
    if(added){matchesPlayed++;persist();}
    clearInputs();
  }
  function clearInputs(){
    for(let i=1;i<=teamCount;i++){
      document.getElementById(`placement${i}`).value="";
      document.getElementById(`finishes${i}`).value="";
      document.getElementById(`impact${i}`).value="0";
      document.getElementById(`bounty${i}`).checked=false;
    }
  }
  function renderLeaderboard(){
    const rows=Object.entries(standings).sort((a,b)=>b[1]-a[1]);
    els.leaderboardBody.innerHTML=rows.map(([t,pts],i)=>{
      let badge="rank-badge";if(i===0)badge+=" top1";else if(i===1)badge+=" top2";else if(i===2)badge+=" top3";
      return `<tr><td><span class="${badge}">${i+1}</span></td><td style="text-align:left">${t}</td><td>${pts}</td></tr>`;
    }).join("");
    els.matchCount.textContent=`(Matches: ${matchesPlayed})`;
  }
  function resetTournament(){
    if(!confirm("Reset tournament?"))return;
    standings={};canonicalNames={};matchesPlayed=0;persist();buildInputs();renderLeaderboard();
  }
  function persist(){
    localStorage.setItem("standings",JSON.stringify(standings));
    localStorage.setItem("canonicalNames",JSON.stringify(canonicalNames));
    localStorage.setItem("teamCount",teamCount);
    localStorage.setItem("matchesPlayed",matchesPlayed);
  }
  async function exportPng(){
    if(!window.html2canvas){alert("Wait...");return;}
    const canvas=await html2canvas(document.getElementById("leaderboardCard"),{scale:2,backgroundColor:"#fff"});
    const a=document.createElement("a");a.href=canvas.toDataURL("image/png");a.download="bgmi_leaderboard.png";a.click();
  }
  function init(){
    els.teamCount.value=teamCount;
    els.teamCount.addEventListener("change",()=>{teamCount=parseInt(els.teamCount.value,10);canonicalNames={};persist();buildInputs();});
    buildInputs();renderLeaderboard();
    els.addMatchBtn.addEventListener("click",addMatch);
    els.generateTableBtn.addEventListener("click",renderLeaderboard);
    els.resetBtn.addEventListener("click",resetTournament);
    els.exportPng.addEventListener("click",exportPng);
  }
  init();
})();
</script>
</body>
</html>
