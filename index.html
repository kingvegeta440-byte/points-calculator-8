<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BGMI Tournament Points Calculator</title>
  <style>
    body{font-family:Arial,sans-serif;background:#f4f6f8;margin:0;padding:0}
    header{background:#1e293b;color:#fff;padding:15px;text-align:center;font-size:20px;font-weight:bold;border-bottom:4px solid #3b82f6}
    main{padding:20px;max-width:1200px;margin:auto}
    section{background:#fff;border-radius:10px;padding:20px;margin-bottom:20px;box-shadow:0 2px 6px rgba(0,0,0,0.1)}
    h2{margin-top:0;border-bottom:2px solid #e5e7eb;padding-bottom:10px;color:#1e293b}
    .controls{margin-bottom:15px}
    .controls label{margin-right:10px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{border:1px solid #e5e7eb;padding:8px;text-align:center}
    th{background:#1e293b;color:#fff}
    tr:nth-child(even){background:#f9fafb}
    .btn{padding:8px 15px;border:none;border-radius:6px;cursor:pointer;font-weight:bold}
    .btn-primary{background:#3b82f6;color:#fff}
    .btn-success{background:#22c55e;color:#fff}
    .btn-danger{background:#ef4444;color:#fff}
    .leaderboard{margin-top:20px}
    .rank-badge{display:inline-block;padding:5px 10px;border-radius:50%;background:#1e293b;color:#fff;font-weight:bold}
    .top1{background:#facc15;color:#000}
    .top2{background:#9ca3af}
    .top3{background:#f97316}
    .flex{display:flex;gap:10px;flex-wrap:wrap}
    input[type="number"]{width:70px}
    input[type="text"]{width:150px}
  </style>
</head>
<body>
<header>BGMI Tournament Points Calculator</header>
<main>
  <section>
    <h2>Match Input</h2>
    <div class="controls">
      <label>Number of Teams:
        <select id="teamCount">
          <option>16</option>
          <option>24</option>
        </select>
      </label>
      <label>
        <input type="checkbox" id="impactToggle"> Enable Impact Finishes (x2)
      </label>
      <label>
        <input type="checkbox" id="bountyToggle"> Enable Bounty (+10)
      </label>
    </div>
    <div id="teamsContainer"></div>
    <div style="margin-top:15px" class="flex">
      <button class="btn btn-primary" id="generate">Generate Points Table</button>
      <button class="btn btn-success" id="addMatch">Add Match</button>
      <button class="btn btn-danger" id="reset">Reset Tournament</button>
    </div>
  </section>

  <section class="leaderboard">
    <h2>üèÜ Leaderboard <span id="matchCount"></span></h2>
    <table>
      <thead>
        <tr>
          <th>Rank</th><th>Team</th><th>Placement Pts</th><th>Kill Pts</th><th>Total</th>
        </tr>
      </thead>
      <tbody id="leaderboardBody"></tbody>
    </table>
  </section>
</main>

<script>
const els = {
  teamCount: document.getElementById("teamCount"),
  impactToggle: document.getElementById("impactToggle"),
  bountyToggle: document.getElementById("bountyToggle"),
  teamsContainer: document.getElementById("teamsContainer"),
  generate: document.getElementById("generate"),
  addMatch: document.getElementById("addMatch"),
  reset: document.getElementById("reset"),
  leaderboardBody: document.getElementById("leaderboardBody"),
  matchCount: document.getElementById("matchCount")
};

// Correct BGMI Placement Points
const placementPoints = [10,6,5,4,3,2,1,1]; // 1st‚Äì8th, 9‚Äì16th = 0

let standings = {};
let matchesPlayed = 0;
let canonicalNames = [];

// Build team input fields
function buildTeamInputs(){
  els.teamsContainer.innerHTML="";
  const n=parseInt(els.teamCount.value);
  for(let i=0;i<n;i++){
    const row=document.createElement("div");
    row.className="flex";
    row.innerHTML=`
      <input type="text" placeholder="Team ${i+1}" class="teamName">
      <input type="number" min="1" max="${n}" placeholder="Place" class="placement">
      <input type="number" min="0" placeholder="Finishes" class="finishes">
      <input type="number" min="0" placeholder="Impact" class="impact">
      <label><input type="checkbox" class="bounty"> Bounty</label>
    `;
    els.teamsContainer.appendChild(row);
  }
}
buildTeamInputs();
els.teamCount.addEventListener("change", buildTeamInputs);

// Calculate current match data
function calculateCurrent(){
  const rows=[...els.teamsContainer.children];
  return rows.map((row,idx)=>{
    const name=row.querySelector(".teamName").value.trim()||`Team${idx+1}`;
    const placement=parseInt(row.querySelector(".placement").value)||0;
    const finishes=parseInt(row.querySelector(".finishes").value)||0;
    const impact=parseInt(row.querySelector(".impact").value)||0;
    const bounty=row.querySelector(".bounty").checked;

    let placementPts=0;
    if(placement>=1 && placement<=8){
      placementPts=placementPoints[placement-1];
    } else if(placement>=9 && placement<=16){
      placementPts=0;
    }

    let killPts=finishes;
    if(els.impactToggle.checked) killPts+=impact*2;
    else killPts+=impact;
    if(els.bountyToggle.checked && bounty) killPts+=10;

    return { name, placementPts, killPts, total: placementPts+killPts };
  });
}

// Escape HTML
function esc(str){
  return str.replace(/[&<>"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s]));
}

// Render leaderboard
function renderLeaderboard(data){
  data.sort((a,b)=>
    b.total-a.total ||
    b.placementPts-a.placementPts ||
    b.killPts-a.killPts ||
    a.name.localeCompare(b.name)
  );
  els.leaderboardBody.innerHTML=data.map((t,idx)=>{
    let badge="rank-badge";
    if(idx===0) badge+=" top1";
    else if(idx===1) badge+=" top2";
    else if(idx===2) badge+=" top3";
    return `<tr>
      <td><span class="${badge}">${idx+1}</span></td>
      <td style="text-align:left">${esc(t.name)}</td>
      <td>${t.placementPts}</td>
      <td>${t.killPts}</td>
      <td>${t.total}</td>
    </tr>`;
  }).join("");
  els.matchCount.textContent=matchesPlayed>0?`(Matches: ${matchesPlayed})`:"";
}

// Buttons
els.generate.addEventListener("click",()=>{
  const cur=calculateCurrent();
  renderLeaderboard(cur);
});

// Add Match (cumulative)
els.addMatch.addEventListener("click",()=>{
  const cur=calculateCurrent();
  if(matchesPlayed===0){
    canonicalNames=cur.map(t=>t.name);
  }
  cur.forEach((t,i)=>{
    const cname=canonicalNames[i]||t.name;
    if(!standings[cname]) standings[cname]={placementPts:0,killPts:0,total:0};
    standings[cname].placementPts+=t.placementPts;
    standings[cname].killPts+=t.killPts;
    standings[cname].total+=t.total;
  });
  matchesPlayed++;
  const data=Object.keys(standings).map(name=>({name, ...standings[name]}));
  renderLeaderboard(data);
});

// Reset
els.reset.addEventListener("click",()=>{
  if(!confirm("Reset tournament?")) return;
  standings={};
  matchesPlayed=0;
  canonicalNames=[];
  buildTeamInputs();
  els.leaderboardBody.innerHTML="";
  els.matchCount.textContent="";
});
</script>
</body>
</html>
