<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tournament Leaderboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-6xl mx-auto">
    <div class="flex flex-wrap gap-2 mb-4 items-center">
      <button onclick="generateTable()" class="bg-blue-600 text-white px-3 py-2 rounded">üîÑ Generate Points Table</button>
      <button onclick="addMatch()" class="bg-green-600 text-white px-3 py-2 rounded">‚ûï Add Match</button>
      <button onclick="resetAll()" class="bg-red-600 text-white px-3 py-2 rounded">‚õî Reset Tournament</button>
    </div>
    
    <div id="teamsContainer" class="grid grid-cols-2 gap-2 mb-4"></div>
    
    <div id="leaderboardCard" class="bg-white rounded-2xl shadow p-4">
      <h2 class="text-xl font-bold mb-2">üèÜ Leaderboard</h2>
      <div id="leaderboard"></div>
    </div>
  </div>

<script>
let teams = JSON.parse(localStorage.getItem("standings")) || {};
let matches = parseInt(localStorage.getItem("matches")) || 0;

const placementPoints = [10,6,5,4,3,2,1,1]; // 1st‚Äì8th placement
function getPlacementPts(place){
  if(place>=1 && place<=8) return placementPoints[place-1];
  return 0;
}

function renderInputs(){
  const container=document.getElementById("teamsContainer");
  container.innerHTML="";
  let teamCount = parseInt(localStorage.getItem("teamCount")) || 16;
  for(let i=0;i<teamCount;i++){
    let div=document.createElement("div");
    div.className="flex gap-1 items-center";
    div.innerHTML=`
      <input placeholder="Team name" class="teamName border p-1 rounded w-24"
             value="${localStorage.getItem("teamName"+i)||""}">
      <input type="number" placeholder="Place" class="place border p-1 rounded w-16">
      <input type="number" placeholder="Finish" class="finish border p-1 rounded w-16">
    `;
    container.appendChild(div);
  }
}

function addMatch(){
  matches++;
  document.getElementById("teamsContainer").querySelectorAll("div").forEach(div=>{
    let name=div.querySelector(".teamName").value.trim();
    let placement=parseInt(div.querySelector(".place").value)||0;
    let fins=parseInt(div.querySelector(".finish").value)||0;
    if(!name) return;
    localStorage.setItem("teamName"+name,name);
    
    if(!teams[name]) teams[name]={matches:0,wwcd:0,placementPts:0,killPts:0,total:0};
    teams[name].matches++;
    if(placement===1) teams[name].wwcd++;
    teams[name].placementPts += getPlacementPts(placement);
    teams[name].killPts += fins;
    teams[name].total = Number(teams[name].placementPts) + Number(teams[name].killPts);
  });
  localStorage.setItem("standings",JSON.stringify(teams));
  localStorage.setItem("matches",matches);
  renderLeaderboard();
}

function renderLeaderboard(){
  let data=Object.entries(teams).map(([name,stats])=>({
    name,
    matches: Number(stats.matches),
    wwcd: Number(stats.wwcd),
    placementPts: Number(stats.placementPts),
    killPts: Number(stats.killPts),
    total: Number(stats.total)
  }));

  // ‚úÖ FIXED SORTING
  data.sort((a,b)=>{
    if(b.total!==a.total) return b.total-a.total;
    if(b.placementPts!==a.placementPts) return b.placementPts-a.placementPts;
    if(b.killPts!==a.killPts) return b.killPts-a.killPts;
    return a.name.localeCompare(b.name);
  });

  let html=`<table class="w-full text-sm border">
    <thead class="bg-black text-white">
      <tr>
        <th class="p-1">Rank</th>
        <th class="p-1">Team</th>
        <th class="p-1">Matches</th>
        <th class="p-1">WWCD</th>
        <th class="p-1">Placement Pts</th>
        <th class="p-1">Kill Pts</th>
        <th class="p-1">Total</th>
      </tr>
    </thead><tbody>`;
  data.forEach((t,i)=>{
    html+=`<tr class="odd:bg-gray-100">
      <td class="p-1 text-center">${i+1}</td>
      <td class="p-1 font-bold">${t.name}</td>
      <td class="p-1 text-center">${t.matches}</td>
      <td class="p-1 text-center">${t.wwcd}</td>
      <td class="p-1 text-center">${t.placementPts}</td>
      <td class="p-1 text-center">${t.killPts}</td>
      <td class="p-1 text-center">${t.total}</td>
    </tr>`;
  });
  html+="</tbody></table>";
  document.getElementById("leaderboard").innerHTML=html;
}

function generateTable(){ renderLeaderboard(); }
function resetAll(){
  teams={}; matches=0;
  localStorage.clear();
  renderInputs(); renderLeaderboard();
}

renderInputs(); renderLeaderboard();
</script>
</body>
</html>
